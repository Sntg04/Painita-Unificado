<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login - Painita</title>
  <style>
    :root { --primary:#B00020; --white:#fff; --black:#000; }
    body { font-family: 'Nunito', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans"; margin: 20px; color: var(--black); background: var(--white); }
    h1 { font-size: 1.5rem; margin-bottom: 8px; font-family:'Playfair Display', serif; color: var(--primary); }
    .muted { color: #666; font-size: .95rem; }
    .center-screen { width:100%; min-height: calc(100dvh - 40px); display:flex; align-items:center; justify-content:center; }
    .card { background:#fff; border-radius:12px; border:1px solid rgba(0,0,0,0.08); padding:20px; box-shadow:0 8px 32px rgba(176,0,32,0.08); max-width:440px; width:100%; display:flex; flex-direction:column; gap:16px; }
    .brand { margin:0; text-align:center; font-family:'Playfair Display', serif; color: var(--primary); font-size: clamp(2.2rem, 5vw, 3rem); letter-spacing:.6px; }
    .title { margin:0; text-align:center; color:#333; font-weight:800; font-size:1.25rem; }
    .form { display:flex; flex-direction:column; gap:12px; }
    label { font-weight:700; font-size:0.95rem; color:#333; }
    .input { padding:10px; border:1px solid #ccc; border-radius:8px; width:100%; font-size:1rem; }
    .btn { padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-family:'Nunito', sans-serif; font-weight:700; }
    .btn-primary { background:var(--primary); color:#fff; }
    .btn-primary:hover { filter:brightness(0.98); }
    .error { color:#b00020; font-size:0.95rem; }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Playfair+Display:wght@700;800;900&display=swap" rel="stylesheet">
</head>
<body>
  <div id="login" class="center-screen">
    <div class="card">
      <h1 class="brand">Painita</h1>
      <h2 class="title">Iniciar sesión</h2>
      <div class="form">
        <div>
          <label for="user">Usuario</label>
          <input id="user" class="input" placeholder="tu_usuario" autocomplete="username"/>
        </div>
        <div>
          <label for="pass">Contraseña</label>
          <input id="pass" class="input" type="password" placeholder="••••••••" autocomplete="current-password"/>
        </div>
        <button id="doLogin" class="btn btn-primary">Entrar</button>
        <div id="lerr" class="error"></div>
      </div>
    </div>
  </div>
  <script>
    async function doLogin() {
      const email = document.getElementById('user').value.trim();
      const pass = document.getElementById('pass').value;
      const lerr = document.getElementById('lerr'); lerr.textContent='';
      const r = await fetch('/admin/login', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({ email, password: pass }) });
      let d = null; try { d = await r.json(); } catch {}
      if (!r.ok || !d?.ok) {
        if (r.status === 404) { lerr.textContent = 'Usuario incorrecto o no existe'; return; }
        if (r.status === 401) { lerr.textContent = 'Contraseña incorrecta'; return; }
        lerr.textContent = d?.error || 'Login fallido';
        return;
      }
      try {
        const meR = await fetch('/me', { credentials:'include' });
        const me = await meR.json();
        if (me?.ok && me.user?.role) {
          if (me.user.role === 'admin') { location.href = '/admin.html'; return; }
          if (me.user.role === 'agent') { location.href = '/asesor.html'; return; }
        }
      } catch{}
      location.href = '/admin.html';
    }
    document.getElementById('doLogin').addEventListener('click', doLogin);
    document.getElementById('pass').addEventListener('keydown', (e)=>{ if(e.key==='Enter') doLogin(); });
  // Nota: se eliminó la auto-redirección para que el login siempre aparezca primero.
  </script>
</body>
</html>
